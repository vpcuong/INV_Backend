model ItemCategory {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  items       Item[]
}

model ItemType {
  id          Int      @id @default(autoincrement())
  code        String?
  name        String
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  items       Item[]
}

model Item {
  id             Int            @id @default(autoincrement())
  name           String
  categoryId     Int
  itemTypeId     Int
  materialId     Int?
  model          String?
  lengthCm       Float?
  widthCm        Float?
  heightCm       Float?
  weightG        Float?
  notes          String?
  status         String?
  hasSku         Boolean        @default(false)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  costPrice      Float?
  isManufactured Boolean        @default(false)
  isPurchasable  Boolean        @default(false)
  isSellable     Boolean        @default(false)
  sellingPrice   Float?
  uomCode        String?
  category       ItemCategory   @relation(fields: [categoryId], references: [id])
  itemType       ItemType       @relation(fields: [itemTypeId], references: [id])
  material       Material?      @relation(fields: [materialId], references: [id])
  uom            UOM?           @relation(fields: [uomCode], references: [code])
  revisions      ItemRevision[]
  itemUoms       ItemUOM[]
  soDetails      SODetail[]
  suppliers      SupplierItem[]
}

model ItemRevision {
  id          Int       @id @default(autoincrement())
  itemId      Int
  revision    String
  name        String?
  notes       String?
  status      String?
  effectiveAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  item        Item      @relation(fields: [itemId], references: [id], onDelete: Cascade)
  skus        ItemSKU[]
}

model ItemSKU {
  id           Int          @id @default(autoincrement())
  skuCode      String       @unique
  revisionId   Int
  colorId      Int
  genderId     Int
  sizeId       Int
  pattern      String?
  lengthCm     Float?
  widthCm      Float?
  heightCm     Float?
  weightG      Float?
  notes        String?
  status       String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  costPrice    Float?       @default(0)
  sellingPrice Float?       @default(0)
  uomCode      String?
  color        Color        @relation(fields: [colorId], references: [id])
  gender       Gender       @relation(fields: [genderId], references: [id])
  revision     ItemRevision @relation(fields: [revisionId], references: [id], onDelete: Cascade)
  size         Size         @relation(fields: [sizeId], references: [id])
  uom          UOM?         @relation(fields: [uomCode], references: [code])
  skuUoms      SKUUOM[]
  soDetails    SODetail[]
}

model ItemUOM {
  itemId             Int
  uomCode            String
  toBaseFactor       Decimal  @db.Decimal(18, 6)
  roundingPrecision  Int?     @default(2)
  isDefaultTransUom  Boolean  @default(false)
  isPurchasingUom    Boolean  @default(false)
  isSalesUom         Boolean  @default(false)
  isManufacturingUom Boolean  @default(false)
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  desc               String   @default("")
  uom                UOM      @relation("ItemUOMs", fields: [uomCode], references: [code])
  item               Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@id([itemId, uomCode])
  @@index([itemId], map: "ix_itemuom_item")
  @@index([uomCode], map: "ix_itemuom_uom")
  @@map("ItemUOM")
}

model SKUUOM {
  id                 Int      @id @default(autoincrement())
  skuId              Int
  toBaseFactor       Decimal  @db.Decimal(18, 6)
  roundingPrecision  Int?     @default(2)
  isDefaultTransUom  Boolean  @default(false)
  isPurchasingUom    Boolean  @default(false)
  isSalesUom         Boolean  @default(false)
  isManufacturingUom Boolean  @default(false)
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  desc               String   @default("")
  uomCode            String
  sku                ItemSKU  @relation(fields: [skuId], references: [id], onDelete: Cascade)
  uom                UOM      @relation("SKUUOMs", fields: [uomCode], references: [code])

  @@unique([skuId, uomCode], name: "ux_sku_uom_once")
  @@index([skuId], map: "ix_skuuom_sku")
  @@index([uomCode], map: "ix_skuuom_uom")
  @@map("SKUUOM")
}
