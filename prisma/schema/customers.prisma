model Customer {
  id           Int                   @id @default(autoincrement())
  customerCode String                @unique @db.VarChar(50)
  customerName String                @db.VarChar(200)
  phone        String?
  email        String?
  taxCode      String?               @db.VarChar(50)
  country      String?               @db.VarChar(100)
  status       CustomerStatus        @default(ACTIVE)
  note         String?
  isActive     Boolean               @default(true)
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  createdBy    String?               @db.VarChar(50)
  sortOrder    Int                   @default(0)
  addresses    CustomerAddress[]
  contacts     CustomerContact[]
  paymentTerms CustomerPaymentTerm[]
  salesOrders  SOHeader[]
  itemModels   ItemModel[]

  @@index([customerCode])
  @@index([status])
}

model CustomerAddress {
  id               Int         @id @default(autoincrement())
  customerId       Int
  addressType      AddressType
  addressLine      String      @db.VarChar(500)
  ward             String?     @db.VarChar(100)
  district         String?     @db.VarChar(100)
  city             String      @db.VarChar(100)
  province         String?     @db.VarChar(100)
  country          String      @db.VarChar(100)
  postalCode       String?     @db.VarChar(20)
  isDefault        Boolean     @default(false)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  customer         Customer    @relation(fields: [customerId], references: [id], onDelete: Cascade)
  soBillingOrders  SOHeader[]  @relation("SOBillingAddress")
  soShippingOrders SOHeader[]  @relation("SOShippingAddress")

  @@index([customerId])
  @@index([addressType])
}

model CustomerContact {
  id         Int      @id @default(autoincrement())
  customerId Int
  fullName   String   @db.VarChar(200)
  position   String?  @db.VarChar(100)
  department String?  @db.VarChar(100)
  phone      String?  @db.VarChar(50)
  email      String?  @db.VarChar(255)
  zalo       String?  @db.VarChar(50)
  wechat     String?  @db.VarChar(50)
  isPrimary  Boolean  @default(false)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([email])
}

model CustomerPaymentTerm {
  id            Int             @id @default(autoincrement())
  customerId    Int
  paymentTerm   PaymentTermCode
  creditLimit   Decimal?        @db.Decimal(18, 2)
  currency      String          @default("VND") @db.VarChar(10)
  effectiveFrom DateTime
  effectiveTo   DateTime?
  isActive      Boolean         @default(true)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  createdBy     String?         @db.VarChar(50)
  customer      Customer        @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([effectiveFrom, effectiveTo])
}

enum CustomerStatus {
  ACTIVE
  INACTIVE
  BLACKLIST
}

enum AddressType {
  HQ
  BILLING
  SHIPPING
  FACTORY
}

enum PaymentTermCode {
  COD
  PREPAID
  NET7
  NET15
  NET30
  NET45
  NET60
  NET90
  EOM
  CUSTOM
}
