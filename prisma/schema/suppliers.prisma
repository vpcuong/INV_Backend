model Supplier {
  id            Int            @id @default(autoincrement())
  code          String         @unique
  name          String
  phone         String?
  email         String?
  website       String?
  address       String?
  city          String?
  province      String?
  country       String?
  postalCode    String?
  taxId         String?
  contactPerson String?
  paymentTerms  String?
  status        String?
  category      String?
  rating        Float?
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  createdBy     String?
  sortOrder     Int            @default(0)
  supplierItems SupplierItem[]
  poHeader      POHeader[]
  fabricItems   Item[]
}

model SupplierItem {
  id               Int                     @id @default(autoincrement())
  supplierId       Int
  itemId           Int
  supplierItemCode String?
  currency         String?
  unitPrice        Decimal?
  leadTimeDays     Int?
  isActive         Boolean                 @default(true)
  createdAt        DateTime                @default(now())
  updatedAt        DateTime                @updatedAt
  item             Item                    @relation(fields: [itemId], references: [id])
  supplier         Supplier                @relation(fields: [supplierId], references: [id])
  packagings       SupplierItemPackaging[]

  @@unique([supplierId, itemId])
}

model SupplierItemPackaging {
  id              Int          @id @default(autoincrement())
  supplierItemId  Int
  level           Int
  /// Số lượng "cấp ngay trước" nằm trong 1 đơn vị packaging này.
  /// - Nếu level = 1: qtyPerPrevLevel = số EA trong 1 đơn vị này (vì "prev" = base UOM).
  /// - Nếu level = 2: qtyPerPrevLevel = số cấp 1 trong 1 đơn vị level 2.
  /// - Nếu level = 3: qtyPerPrevLevel = số cấp 2 trong 1 đơn vị level 3, v.v.
  qtyPerPrevLevel Int
  /// Giá trị pre-calculated: số EA trong 1 đơn vị packaging này
  /// (có thể compute bằng code rồi lưu, hoặc để null và tính runtime).
  qtyToBase       Int?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  uomCode         String
  supplierItem    SupplierItem @relation(fields: [supplierItemId], references: [id])
  uom             UOM          @relation(fields: [uomCode], references: [code])

  @@unique([supplierItemId, level])
}
