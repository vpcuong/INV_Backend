model SOHeader {
  id                    Int              @id @default(autoincrement())
  soNum                 String           @unique @db.VarChar(50)
  customerId            Int
  customerPoNum         String?          @db.VarChar(100)
  orderDate             DateTime         @default(now())
  requestDate           DateTime?
  needByDate            DateTime?
  orderStatus           SOStatus         @default(OPEN)
  channel               String?          @db.VarChar(50)
  fobCode               String?          @db.VarChar(20)
  shipViaCode           String?          @db.VarChar(20)
  paymentTermCode       PaymentTermCode?
  currencyCode          String           @db.VarChar(3)
  exchangeRate          Decimal          @default(1) @db.Decimal(18, 6)
  headerDiscountPercent Decimal          @default(0) @db.Decimal(5, 2)
  headerDiscountAmount  Decimal          @default(0) @db.Decimal(18, 2)
  totalLineAmount       Decimal          @default(0) @db.Decimal(18, 2)
  totalDiscount         Decimal          @default(0) @db.Decimal(18, 2)
  totalTax              Decimal          @default(0) @db.Decimal(18, 2)
  totalCharges          Decimal          @default(0) @db.Decimal(18, 2)
  orderTotal            Decimal          @default(0) @db.Decimal(18, 2)
  openAmount            Decimal          @default(0) @db.Decimal(18, 2)
  billingAddressId      Int?
  shippingAddressId     Int?
  headerNote            String?
  internalNote          String?
  createdBy             String           @db.VarChar(100)
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  deletedAt             DateTime?
  deletedBy             String?          @db.VarChar(100)
  lines                 SODetail[]
  billingAddress        CustomerAddress? @relation("SOBillingAddress", fields: [billingAddressId], references: [id])
  customer              Customer         @relation(fields: [customerId], references: [id])
  shippingAddress       CustomerAddress? @relation("SOShippingAddress", fields: [shippingAddressId], references: [id])

  @@index([customerId])
  @@index([orderStatus])
  @@index([orderDate])
  @@index([soNum])
  @@index([deletedAt])
  @@map("SOHeader")
}

model SODetail {
  id                  Int          @id @default(autoincrement())
  soHeaderId          Int
  lineNum             Int
  itemId              Int?
  itemSkuId           Int?
  itemCode            String       @db.VarChar(50)
  description         String?      @db.VarChar(500)
  orderQty            Decimal      @db.Decimal(18, 4)
  unitPrice           Decimal      @db.Decimal(18, 4)
  lineDiscountPercent Decimal      @default(0) @db.Decimal(5, 2)
  lineDiscountAmount  Decimal      @default(0) @db.Decimal(18, 2)
  lineTaxPercent      Decimal      @default(0) @db.Decimal(5, 2)
  lineTaxAmount       Decimal      @default(0) @db.Decimal(18, 2)
  lineTotal           Decimal      @default(0) @db.Decimal(18, 2)
  needByDate          DateTime?
  lineStatus          SOLineStatus @default(OPEN)
  openQty             Decimal      @db.Decimal(18, 4)
  shippedQty          Decimal      @default(0) @db.Decimal(18, 4)
  warehouseCode       String?      @db.VarChar(20)
  lineNote            String?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  uomCode             String       @db.VarChar(50)
  item                Item?        @relation(fields: [itemId], references: [id])
  itemSku             ItemSKU?     @relation(fields: [itemSkuId], references: [id])
  header              SOHeader     @relation(fields: [soHeaderId], references: [id], onDelete: Cascade)
  uom                 UOM          @relation(fields: [uomCode], references: [code])

  @@unique([soHeaderId, lineNum])
  @@index([itemId])
  @@index([itemSkuId])
  @@index([lineStatus])
  @@map("SODetail")
}

enum SOStatus {
  DRAFT
  OPEN
  PARTIAL
  CLOSED
  CANCELLED
  ON_HOLD
}

enum SOLineStatus {
  OPEN
  PARTIAL
  CLOSED
  CANCELLED
  BACKORDERED
}
